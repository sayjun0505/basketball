import{n as W,o as P,s as x,p as L,a as w,q as D,v as A,w as G,r as u,d,x as k,j as t,T as v,y as O,F as y,P as I,I as $,z as R,A as Q,B as j,C as H,m as K,u as z,E as U,G as E,H as q,J as S,D as J,K as X,_ as V,M as Y,N as Z,O as _}from"./index-cy1M6gwN.js";import{k as ee}from"./index-bs3yfeIa.js";import{C as te}from"./CircularProgress-zvc8Fxj-.js";const oe={selectedContactId:"",open:!1},N=W({name:"chatPanel",initialState:oe,reducers:{setSelectedContactId:(e,o)=>{e.selectedContactId=o.payload},removeSelectedContactId:e=>{e.selectedContactId=""},toggleChatPanel:e=>{e.open=!e},openChatPanel:e=>{e.open=!0},closeChatPanel:e=>{e.open=!1}},selectors:{selectSelectedContactId:e=>e.selectedContactId,selectChatPanelOpen:e=>e.open}});P.inject(N);const ae=N.injectInto(P),{setSelectedContactId:ne,openChatPanel:F,toggleChatPanel:ve,removeSelectedContactId:ye,closeChatPanel:C}=N.actions,{selectSelectedContactId:T,selectChatPanelOpen:se}=ae.selectors;N.reducer;const re=x("div")(({theme:e})=>({"&.contact":{"& .bubble":{backgroundColor:L(e.palette.secondary.main,.1),color:e.palette.secondary.contrastText,borderTopLeftRadius:5,borderBottomLeftRadius:5,borderTopRightRadius:20,borderBottomRightRadius:20,"& .time":{marginLeft:12}},"&.first-of-group":{"& .bubble":{borderTopLeftRadius:20}},"&.last-of-group":{"& .bubble":{borderBottomLeftRadius:20}}},"&.me":{paddingLeft:40,"& .bubble":{marginLeft:"auto",backgroundColor:L(e.palette.primary.main,.1),color:e.palette.primary.contrastText,borderTopLeftRadius:20,borderBottomLeftRadius:20,borderTopRightRadius:5,borderBottomRightRadius:5,"& .time":{justifyContent:"flex-end",right:0,marginRight:12}},"&.first-of-group":{"& .bubble":{borderTopRightRadius:20}},"&.last-of-group":{"& .bubble":{borderBottomRightRadius:20}}},"&.contact + .me, &.me + .contact":{paddingTop:20,marginTop:20},"&.first-of-group":{"& .bubble":{borderTopLeftRadius:20,paddingTop:13}},"&.last-of-group":{"& .bubble":{borderBottomLeftRadius:20,paddingBottom:13,"& .time":{display:"flex"}}}}));function le(e){const{className:o}=e,i=w(T),{data:a}=D(i),{data:h}=A(),[c]=G(),[n,r]=u.useState(""),p=u.useRef(null);u.useEffect(()=>{m()},[a]);function m(){p.current&&p.current.scrollTo({top:p.current.scrollHeight,behavior:"instant"})}const b=g=>{r(g.target.value)};return d(I,{className:k("flex flex-col relative pb-64 shadow",o),sx:{background:g=>g.palette.background.default},children:[d("div",{ref:p,className:"flex flex-1 flex-col overflow-y-auto overscroll-contain",children:[t("div",{className:"flex flex-col pt-16",children:u.useMemo(()=>{function g(f,l){return l===0||a[l-1]&&a[l-1].contactId!==f.contactId}function s(f,l){return l===a.length-1||a[l+1]&&a[l+1].contactId!==f.contactId}return(a==null?void 0:a.length)>0?a.map((f,l)=>t(re,{className:k("flex flex-col grow-0 shrink-0 items-start justify-end relative px-16 pb-4",f.contactId===h.id?"me":"contact",{"first-of-group":g(f,l)},{"last-of-group":s(f,l)},l+1===a.length&&"pb-72"),children:d("div",{className:"bubble flex relative items-center justify-center p-12 max-w-full",children:[t("div",{className:"leading-tight whitespace-pre-wrap",children:f.value}),t(v,{className:"time absolute hidden w-full text-11 mt-8 -mb-24 ltr:left-0 rtl:right-0 bottom-0 whitespace-nowrap",color:"text.secondary",children:O(new Date(f.createdAt),{addSuffix:!0})})]})},l)):null},[a,h==null?void 0:h.id])}),(a==null?void 0:a.length)===0&&d("div",{className:"flex flex-col flex-1",children:[t("div",{className:"flex flex-col flex-1 items-center justify-center",children:t(y,{size:128,color:"disabled",children:"heroicons-outline:chat"})}),t(v,{className:"px-16 pb-24 text-center",color:"text.secondary",children:"Start a conversation by typing your message below."})]})]}),u.useMemo(()=>a&&t("form",{onSubmit:s=>{s.preventDefault(),n!==""&&(c({message:n,contactId:i}),r(""))},className:"pb-16 px-8 absolute bottom-0 left-0 right-0",children:d(I,{className:"rounded-24 flex items-center relative shadow",children:[t($,{autoFocus:!1,id:"message-input",className:"flex flex-1 grow shrink-0 mx-16 ltr:mr-48 rtl:ml-48 my-8",placeholder:"Type your message",onChange:b,value:n}),t(R,{className:"absolute ltr:right-0 rtl:left-0 top-0",type:"submit",size:"large",children:t(y,{className:"rotate-90",color:"action",children:"heroicons-outline:paper-airplane"})})]})}),[a,n,i])]})}const ie=x("div")(({theme:e,value:o})=>({position:"absolute",width:12,height:12,bottom:4,left:44,border:`2px solid ${e.palette.background.default}`,borderRadius:"50%",zIndex:10,...o==="online"&&{backgroundColor:"#4CAF50"},...o==="do-not-disturb"&&{backgroundColor:"#F44336"},...o==="away"&&{backgroundColor:"#FFC107"},...o==="offline"&&{backgroundColor:"#646464"}}));function ce(e){const{value:o}=e;return t(ie,{value:o})}const de=x(Q)(({theme:e,active:o})=>({width:70,minWidth:70,flex:"0 0 auto",...o&&{"&:after":{position:"absolute",top:8,right:0,bottom:8,content:"''",width:4,borderTopLeftRadius:4,borderBottomLeftRadius:4,backgroundColor:e.palette.primary.main}}})),ue=x("div")(({theme:e})=>({position:"absolute",minWidth:18,height:18,top:4,left:10,borderRadius:9,padding:"0 5px",fontSize:11,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:e.palette.secondary.main,color:e.palette.secondary.contrastText,boxShadow:"0 2px 2px 0 rgba(0, 0, 0, 0.35)",zIndex:10}));function B(e){const{contact:o,selectedContactId:i,onClick:a}=e;return t(de,{title:o.name,placement:"left",active:i===o.id?1:0,children:d(H,{onClick:()=>a(o.id),className:k("contactButton rounded-0 py-4 h-auto min-h-auto max-h-none",i===o.id&&"active"),children:[!!o.unreadCount&&t(ue,{children:o.unreadCount}),t(ce,{value:o.status}),t(j,{src:o.avatar,alt:o.name,children:!o.avatar||o.avatar===""?o.name[0]:""})]})})}const pe=x(K)(({theme:e})=>({background:e.palette.background.paper})),fe={show:{transition:{staggerChildren:.025}}},M={hidden:{opacity:0,scale:.6},show:{opacity:1,scale:1}};function he(e){const{className:o}=e,i=z(),a=w(T),h=u.useRef(null),{data:c,isLoading:n}=U(),{data:r,isLoading:p}=E(),m=u.useMemo(()=>(r==null?void 0:r.length)>0&&(c==null?void 0:c.length)>0?c.map(s=>({...s,...r.find(f=>f.id===s.contactId)})):[],[r,c]),b=()=>{h.current&&(h.current.scrollTop=0)},g=s=>{i(F()),i(ne(s)),b()};return p||n?t(q,{className:"flex justify-center py-12",sx:{width:70,minWidth:70},children:t(te,{color:"secondary"})}):t(pe,{className:k("flex shrink-0 flex-col overflow-y-auto py-8 overscroll-contain",o),ref:h,option:{suppressScrollX:!0,wheelPropagation:!1},children:(r==null?void 0:r.length)>0&&d(S.div,{variants:fe,initial:"hidden",animate:"show",className:"flex flex-col shrink-0",children:[m&&m.map(s=>t(S.div,{variants:M,children:t(B,{contact:s,selectedContactId:a,onClick:g})},s.id)),t(J,{className:"mx-24 my-8"}),r.map(s=>c.find(l=>l.contactId===s.id)?null:t(S.div,{variants:M,children:t(B,{contact:s,selectedContactId:a,onClick:g})},s.id))]})})}const me=u.memo(he),ge=x("div")(({theme:e,opened:o})=>({position:"sticky",display:"flex",top:0,width:70,maxWidth:70,minWidth:70,height:"100vh",zIndex:1e3,[e.breakpoints.down("lg")]:{position:"fixed",height:"100%",width:0,maxWidth:0,minWidth:0},...o&&{overflow:"visible"},...!o&&{overflow:"hidden",animation:`hide-panel 1ms linear ${e.transitions.duration.standard}`,animationFillMode:"forwards"},"& > .panel":{position:"absolute",top:0,right:0,bottom:0,left:0,width:360,minWidth:360,height:"100%",margin:0,overflow:"hidden",zIndex:1e3,backgroundColor:e.palette.background.paper,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",transform:"translate3d(0,0,0)",transition:e.transitions.create(["transform"],{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.standard}),...o&&{transform:e.direction==="rtl"?"translate3d(290px,0,0)":"translate3d(-290px,0,0)"},[e.breakpoints.down("lg")]:{left:"auto",position:"fixed",transform:e.direction==="rtl"?"translate3d(-360px,0,0)":"translate3d(360px,0,0)",boxShadow:"none",width:320,minWidth:320,maxWidth:"100%",...o&&{transform:"translate3d(0,0,0)",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"}}},"@keyframes hide-panel":{"0%":{overflow:"visible"},"99%":{overflow:"visible"},"100%":{overflow:"hidden"}}}));function we(){const e=z(),o=X(),i=u.useRef(null),a=w(T),{data:h}=E(),c=V.find(h,{id:a}),n=w(se),r=Y({onSwipedLeft:()=>n&&o.direction==="rtl"&&e(C()),onSwipedRight:()=>n&&o.direction==="ltr"&&e(C())}),p=u.useCallback(m=>{ee(m)==="esc"&&e(C())},[e]);return u.useEffect(()=>()=>{document.removeEventListener("keydown",p)},[e,p]),u.useEffect(()=>{n?document.addEventListener("keydown",p):document.removeEventListener("keydown",p)},[p,n]),u.useEffect(()=>{function m(b){i.current&&!i.current.contains(b.target)&&e(C())}return n&&document.addEventListener("click",m,!0),()=>{n&&document.removeEventListener("click",m,!0)}},[n,e]),t(ge,{opened:n?1:0,...r,children:d("div",{className:"panel flex flex-col max-w-full",ref:i,children:[t(Z,{position:"static",className:"shadow-md",children:d(_,{className:"px-4",children:[(!n||a==="")&&d("div",{className:"flex flex-1 items-center px-8 space-x-12",children:[t(R,{className:"",color:"inherit",onClick:()=>e(F()),size:"large",children:t(y,{size:24,children:"heroicons-outline:chat-alt-2"})}),a===""&&t(v,{className:"text-16",color:"inherit",children:"Team Chat"})]}),n&&c&&d("div",{className:"flex flex-1 items-center px-12",children:[t(j,{src:c.avatar}),t(v,{className:"mx-16 text-16",color:"inherit",children:c.name})]}),t("div",{className:"flex px-4",children:t(R,{onClick:()=>e(C()),color:"inherit",size:"large",children:t(y,{children:"heroicons-outline:x"})})})]})}),d(I,{className:"flex flex-1 flex-row min-h-px shadow-0",children:[t(me,{className:"flex shrink-0"}),n&&c?t(le,{className:"flex flex-1 z-10"}):d("div",{className:"flex flex-col flex-1 items-center justify-center p-24",children:[t(y,{size:128,color:"disabled",children:"heroicons-outline:chat"}),t(v,{className:"px-16 pb-24 mt-24 text-center",color:"text.secondary",children:"Select a contact to start a conversation."})]})]})]})})}export{we as default};
